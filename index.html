<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Doutzen Tracker</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0f172a" />
  <style>
    body { font-family: system-ui, sans-serif; margin:0; background:#0f172a; color:#f8fafc; }
    h1,h2 { color:#f1f5f9; margin:0 0 8px 0; }
    .container { max-width:640px; margin:auto; padding:16px; }
    .card { background:#1e293b; border-radius:12px; padding:16px; margin-bottom:16px; box-shadow:0 2px 4px rgba(0,0,0,0.2);}
    .row { display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap;}
    .btn { background:#2563eb; color:white; border:none; padding:8px 14px; border-radius:8px; cursor:pointer; font-size:15px;}
    .btn:active { transform:scale(0.97);}
    input,select,textarea { background:#334155; color:#f1f5f9; border:none; border-radius:6px; padding:6px; }
    textarea{width:100%; min-height:60px;}
    .emoji{font-size:28px; cursor:pointer; margin-right:4px;}
    .active{outline:2px solid #38bdf8; border-radius:8px;}
    .small{font-size:14px; color:#cbd5e1;}
    .pill{background:#334155; border-radius:16px; padding:4px 10px; font-size:14px;}
    table{width:100%;border-collapse:collapse;}
    th,td{padding:6px 4px;border-bottom:1px solid #1f2937;text-align:left;}
    a{color:#38bdf8;text-decoration:none;}
    a:hover{text-decoration:underline;}
  </style>
</head>
<body>
  <div class="container">
    <h1>Doutzen Tracker 💪</h1>

    <section class="card">
      <h2>1) Hoe voel je je vandaag?</h2>
      <div id="mood" class="row"></div>
    </section>

    <section class="card">
      <h2>2) Knie</h2>
      <div class="row">
        <input id="pain" type="range" min="0" max="10" step="1" />
        <span id="painVal"></span>
      </div>
    </section>

    <section class="card">
      <h2>3) Water</h2>
      <div class="row">
        <button class="btn" id="waterMinus">−</button>
        <span id="waterVal"></span>
        <button class="btn" id="waterPlus">+</button>
      </div>
    </section>

    <section class="card">
      <h2>4) Trainen & Rekken</h2>
      <div class="row">
        <button class="btn" id="trainBtn">🏋️‍♀️ Getraind</button>
        <button class="btn" id="stretchBtn">🧘‍♀️ Gerekt</button>
      </div>
    </section>

    <section class="card">
      <h2>5) Voeding</h2>
      <textarea id="meal" placeholder="Wat heb je gegeten?"></textarea>
    </section>

    <section class="card">
      <h2>6) Notities</h2>
      <textarea id="note" placeholder="Wat wil je onthouden?"></textarea>
    </section>

    <section class="card">
      <h2>Opslaan</h2>
      <div class="row">
        <button class="btn" id="saveBtn">💾 Opslaan</button>
        <button class="btn" id="resetBtn">Reset</button>
      </div>
      <p class="small">Streak: <span id="streak"></span> dagen</p>
    </section>

    <section class="card" id="weekCard">
      <h2>7) Weekoverzicht</h2>
      <div id="weekTable" class="small"></div>
    </section>

    <section class="card" id="reminderCard">
      <h2>8) Dagelijkse herinnering</h2>
      <div class="row" style="margin-bottom:8px">
        <label>Tijd:</label>
        <input id="reminderTime" type="time" value="19:00" style="max-width:160px" />
        <label class="pill"><input id="reminderEnable" type="checkbox" /> Herinnering aanzetten</label>
        <button class="btn" id="notifyTest">Testmelding</button>
      </div>
      <p class="small" id="reminderStatus"></p>
    </section>

    <section class="card" id="chartsCard">
      <h2>9) Grafieken (7 dagen)</h2>
      <p class="small">Snelle trendweergave. Tip: houd je data dagelijks bij voor mooiere lijnen.</p>
      <div style="display:grid; gap:12px">
        <div><div class="small">Knie (0 = top, 10 = au)</div><canvas id="painChart" width="600" height="220" style="width:100%"></canvas></div>
        <div><div class="small">Water (glazen per dag)</div><canvas id="waterChart" width="600" height="220" style="width:100%"></canvas></div>
      </div>
    </section>

    <section class="card" id="planCard">
      <h2>10) Weekplan Oefeningen</h2>
      <div class="row" style="margin-bottom:8px">
        <label>Startdatum:</label><input id="planStart" type="date" />
        <label>Week:</label><select id="planWeek"></select>
      </div>
      <div id="planInfo" class="small"></div>
      <div id="planList"></div>
    </section>

  </div>

  <footer style="text-align:center;padding:16px;font-size:13px;color:#94a3b8;">© Doutzen Tracker</footer>

<script>
const $ = sel => document.querySelector(sel);
const KEY='doutzen-data'; const todayKey=()=>new Date().toISOString().slice(0,10);
function loadAll(){return JSON.parse(localStorage.getItem(KEY)||'{}');}
function saveAll(o){localStorage.setItem(KEY,JSON.stringify(o));}
function loadToday(){return loadAll()[todayKey()]||{};}
function saveToday(d){const all=loadAll();all[todayKey()]=d;saveAll(all);}
const state={mood:null,pain:0,water:0,trained:false,stretched:false,meal:'',note:''};

const moods=['😀','🙂','😐','😕','😢'];
$('#mood').innerHTML=moods.map(m=>`<span class="emoji" data-mood="${m}">${m}</span>`).join('');

function render(){
  $('#pain').value=state.pain; $('#painVal').textContent=state.pain;
  $('#waterVal').textContent=state.water+' glazen';
  document.querySelectorAll('.emoji').forEach(e=>e.classList.toggle('active',e.dataset.mood===state.mood));
  $('#meal').value=state.meal; $('#note').value=state.note;
  $('#streak').textContent=getStreak();
}

function loadStreak(){return Number(localStorage.getItem('doutzen-streak')||0);}
function saveStreak(n){localStorage.setItem('doutzen-streak',n);}
function getStreak(){return loadStreak();}

function updateStreakAndShowups(){
  const all=loadAll(); const keys=Object.keys(all).sort();
  let streak=0; let last=null;
  keys.forEach(k=>{if(!last){streak=1;}else{const d1=new Date(k),d2=new Date(last);if((d1-d2)/86400000===1){streak++;}}last=k;});
  saveStreak(streak);
}

// Weekoverzicht
function renderWeek(){
  const all=loadAll(); const days=[];
  for(let i=0;i<7;i++){const d=new Date();d.setDate(d.getDate()-i);const key=d.toISOString().slice(0,10);days.push({key,data:all[key]||null});}
  const headers=['Datum','Mood','Knie','Water','Trainen','Rekken'];
  let html='<table><thead><tr>'+headers.map(h=>`<th>${h}</th>`).join('')+'</tr></thead><tbody>';
  days.forEach(({key,data})=>{
    const d=new Date(key);const lab=d.toLocaleDateString('nl-NL',{weekday:'short',day:'2-digit',month:'2-digit'});
    const cells=[lab,data?.mood||'—',data?data.pain:'—',data?data.water:'—',data&&data.trained?'✅':'—',data&&data.stretched?'✅':'—'];
    html+='<tr>'+cells.map(c=>`<td>${c}</td>`).join('')+'</tr>';
  }); html+='</tbody></table>'; $('#weekTable').innerHTML=html;
}

// Herinnering
const reminderKey='doutzen-reminder';
const getReminder=()=>JSON.parse(localStorage.getItem(reminderKey)||'{"enabled":false,"hour":19,"minute":0,"lastFired":""}');
const saveReminder=r=>localStorage.setItem(reminderKey,JSON.stringify(r));
async function ensureNotificationPermission(){
  if(!('Notification'in window))return false;
  if(Notification.permission==='granted')return true;
  if(Notification.permission!=='denied'){const p=await Notification.requestPermission();return p==='granted';}
  return false;
}
function fireReminder(){const t='Doutzen Tracker',b='Check-in: mood, knie, water, training 💪';
  if('Notification'in window&&Notification.permission==='granted'){new Notification(t,{body:b,icon:'./icon-512.png'});}else{alert(b);}
}
function checkReminder(){
  const r=getReminder();if(!r.enabled)return;
  const n=new Date(),hh=n.getHours(),mm=n.getMinutes(),today=n.toISOString().slice(0,10);
  if(hh===r.hour&&mm===r.minute&&r.lastFired!==today){fireReminder();r.lastFired=today;saveReminder(r);}
}
function updateReminderUI(){
  const r=getReminder();const hh=String(r.hour).padStart(2,'0'),mm=String(r.minute).padStart(2,'0');
  $('#reminderTime').value=`${hh}:${mm}`;$('#reminderEnable').checked=!!r.enabled;
  $('#reminderStatus').textContent=r.enabled?`Herinnering aan om ${hh}:${mm}`:'Herinnering uit.';
}
setInterval(checkReminder,60000);

// Grafieken
function collectWeekSeries(){
  const all=loadAll();const labels=[],pain=[],water=[];
  for(let i=6;i>=0;i--){const d=new Date();d.setDate(d.getDate()-i);const key=d.toISOString().slice(0,10);const row=all[key];
    labels.push(d.toLocaleDateString('nl-NL',{weekday:'short',day:'2-digit'}));
    pain.push(row?(typeof row.pain==='number'?row.pain:null):null);
    water.push(row?(typeof row.water==='number'?row.water:null):null);
  }return{labels,pain,water};
}
function drawLine(id,labels,data,opts={}){
  const el=document.getElementById(id);if(!el)return;const ctx=el.getContext('2d');
  ctx.clearRect(0,0,el.width,el.height);const W=el.width,H=el.height,P=30;
  ctx.strokeStyle='#334155';ctx.beginPath();ctx.moveTo(P,10);ctx.lineTo(P,H-P);ctx.lineTo(W-10,H-P);ctx.stroke();
  const minY=opts.minY??0,maxY=opts.maxY??Math.max(10,...data.filter(v=>v!==null));
  ctx.fillStyle='#94a3b8';ctx.font='12px system-ui';
  for(let i=0;i<=5;i++){const v=minY+i*(maxY-minY)/5;const y=H-P-((v-minY)/(maxY-minY||1))*(H-2*P);
    ctx.strokeStyle='#1f2937';ctx.beginPath();ctx.moveTo(P,y);ctx.lineTo(W-10,y);ctx.stroke();ctx.fillText(Math.round(v),6,y+4);}
  const n=labels.length,stepX=(W-2*P)/Math.max(1,n-1);
  labels.forEach((lab,i)=>{const x=P+i*stepX;ctx.fillText(lab,x-12,H-P+16);});
  ctx.strokeStyle=opts.color||'#38bdf8';ctx.lineWidth=2;ctx.beginPath();let start=false;
  data.forEach((v,i)=>{if(v===null)return;const x=P+i*stepX;const y=H-P-((v-minY)/(maxY-minY||1))*(H-2*P);
    if(!start){ctx.moveTo(x,y);start=true;}else{ctx.lineTo(x,y);} });ctx.stroke();
  ctx.fillStyle=opts.color||'#38bdf8';
  data.forEach((v,i)=>{if(v===null)return;const x=P+i*stepX;const y=H-P-((v-minY)/(maxY-minY||1))*(H-2*P);
    ctx.beginPath();ctx.arc(x,y,3,0,Math.PI*2);ctx.fill();});
}
function drawCharts(){
  const{labels,pain,water}=collectWeekSeries();
  drawLine('painChart',labels,pain,{color:'#ef4444',minY:0,maxY:10});
  const maxW=Math.max(8,...water.filter(v=>v!==null));drawLine('waterChart',labels,water,{color:'#22c55e',minY:0,maxY:maxW});
}

// Weekplan (verkort, zie eerdere bericht voor alle weken)
const PLAN_KEY='doutzen-plan';const PLAN_DONE_KEY='doutzen-plan-done';
function loadPlan(){return JSON.parse(localStorage.getItem(PLAN_KEY)||'{}');}
function savePlan(v){localStorage.setItem(PLAN_KEY,JSON.stringify(v));}
function loadPlanDone(){return JSON.parse(localStorage.getItem(PLAN_DONE_KEY)||'{}');}
function savePlanDone(v){localStorage.setItem(PLAN_DONE_KEY,JSON.stringify(v));}
const WEEKS=[{title:'Week 1 – rust & activatie',notes:'Techniek eerst.',items:[{name:'Wall sit',spec:'2×20s'},{name:'Hip bridge',spec:'3×10'},{name:'Side leg lift',spec:'2×15'},{name:'Adem 4-6',spec:'3 min'}]}];
function renderPlan(){
  const cfg=loadPlan(),sel=$('#planWeek');
  if(sel&&sel.options.length===0)WEEKS.forEach((w,i)=>{const o=document.createElement('option');o.value=i;o.textContent=w.title;sel.appendChild(o);});
  const idx=parseInt(sel.value||0);const week=WEEKS[idx];
  $('#planInfo').textContent=week.notes;$('#planList').innerHTML=week.items.map((it,i)=>`<label><input type='checkbox' class='planCheck' data-idx='${i}'/> ${it.name} <span class='small'>(${it.spec})</span></label><br>`).join('');
}
document.addEventListener('change',e=>{
  if(e.target.id==='reminderTime'){const[rh,rm]=e.target.value.split(':').map(Number);const r=getReminder();r.hour=rh;r.minute=rm;saveReminder(r);updateReminderUI();}
  if(e.target.id==='reminderEnable'){const r=getReminder();r.enabled=e.target.checked;saveReminder(r);if(r.enabled)ensureNotificationPermission();updateReminderUI();}
  if(e.target.classList.contains('planCheck'))renderPlan();
});
document.addEventListener('click',e=>{
  const t=e.target;
  if(t.classList.contains('emoji'))state.mood=t.dataset.mood;
  if(t.id==='waterPlus')state.water++;
  if(t.id==='waterMinus')state.water=Math.max(0,state.water-1);
  if(t.id==='trainBtn')state.trained=!state.trained;
  if(t.id==='stretchBtn')state.stretched=!state.stretched;
  if(t.id==='saveBtn'){saveToday({...state});alert('Opgeslagen!');renderWeek();drawCharts();}
  if(t.id==='resetBtn'){Object.assign(state,{mood:null,pain:0,water:0,trained:false,stretched:false,meal:'',note:''});}
  if(t.id==='notifyTest')fireReminder();
  render();
});
$('#pain').addEventListener('input',e=>{state.pain=+e.target.value;$('#painVal').textContent=state.pain;});
$('#meal').addEventListener('input',e=>state.meal=e.target.value);
$('#note').addEventListener('input',e=>state.note=e.target.value);

// Init
Object.assign(state,loadToday());
render();updateStreakAndShowups();renderWeek();updateReminderUI();drawCharts();renderPlan();checkReminder();
</script>
</body>
</html>
